# DP 200 - 实现数据平台解决方案
# 实验室 2 - 使用数据存储

**预计用时**： 60 分钟

**先决条件**： 假设已阅读了本实验室的案例研究。假设模块 1：适用于数据工程师的 Azure 的内容和实验室也已完成

**实验室文件**： 本实验室文件位于 _Allfiles\Labfiles\Starter\DP-200.2_ 文件夹。

## 实验室概述

在本实验室中，学生将能够根据一组给定的业务和技术要求确定要实现的适当存储类型。他们将能够创建 Azure 存储帐户和 Data Lake Storage 帐户，并解释 Data Lake Storage 版本 1 和版本 2 之间的区别。他们还将能够演示如何将数据加载到所选的数据存储中。

## 实验室目标
  
完成本实验室后，你将能够：

1. 在 Azure 中选择数据存储方法
2. 创建 Azure 存储帐户
3. 解释 Azure Data Lake Storage
4. 将数据上传到 Azure Data Lake

## 应用场景
  
你已被聘为高级数据工程师，以实现作为数字化转换项目一部分的技术解决方案。该组织正在将托管公司网站的 Internet 信息服务 (IIS) 迁移到 Azure。开发人员正在将 Web 应用程序及其逻辑传输到 Azure Web 应用，并且他们已经要求你准备一个数据存储，他们可将其用于托管网站上使用的静态图像。

此外，信息服务部门已经通知你，他们的团队正在扩大，不久将有数据科学家加入他们，开始构建预测分析解决方案。你已被要求设置一项解决方案，用于托管其工作的生产环境。在第一个实例中，你将评估为解决方案创建的适当存储层。

在此工作结束时，你将能够：

1. 在 Azure 中选择数据存储方法
2. 创建 Azure 存储帐户
3. 解释 Azure Data Lake Storage
4. 将数据上传到 Azure Data Lake

> **重要事项**： 在完成本实验室课程时，请记下你在任何预配或配置任务中遇到的任何问题，并将其记录在位于 _\Labfiles\DP-200-Issues-Doc.docx_ 的文档的表中。记录实验室编号，记录技术，说明问题以及解决方案的内容。保存该文档，以便在稍后的模块中参考它。

## 练习 1：在 Azure 中选择数据存储方法

预计用时：15 分钟

个人练习
  
本练习的主要任务如下：

1. 从案例研究中，确定针对网站静态图像和预测分析解决方案的数据存储要求。

2. 讲师将与小组讨论结果。

### 任务 1：确定 AdventureWorks 的数据存储要求和结构。

1. 从实验室虚拟机中，启动 **Microsoft Word**，然后从 **Allfiles\Labfiles\Starter\DP-200.2** 文件夹中打开文件 **DP-200-Lab02-Ex01.docx**。

2. 花 **10 分钟** 记录本实验室方案中概述的数据存储要求。你还可以使用案例研究文档作为其他参考。

### 任务 2：与讲师讨论结果

1. 讲师将使小组停下来讨论结果。

> **结果**： 完成本练习后，你已创建一个 Microsoft Word 文档，其中显示两个数据存储要求表。

## 练习 2：创建 Azure 存储帐户
  
预计用时：20 分钟

个人练习
  
本次练习的主要任务如下：

1. 在距离实验室位置最近的区域创建名为 **awrgstudxx** 的 Azure 资源组，其中 **xx** 是你的姓名缩写。

2. 在资源组 awrgstudxx 中，在距离实验室位置最近的区域创建并配置名为 **awsastudxx** 的存储帐户，其中 **xx** 是你的姓名缩写。

3. 在 awsastudxx 存储帐户中创建名为 **图像**、**电话** 和 **推文** 的容器。

4. 将一些图形上传到存储帐户的图像容器中。

### 任务 1：创建和配置资源组。

1. 从实验室虚拟机启动 Microsoft Edge，浏览 Azure 门户 [**http://portal.azure.com**](http://portal.azure.com)，并使用已分配给你的课程帐户登录。

2. 在 Azure 门户中，单击 **“资源组”** 图标。

3. 从 **“资源组”** 屏幕中，单击 **“+ 添加”**，使用以下设置创建第一个资源组：

    - **订阅**： 你用于本实验室的订阅名称
    
    - **资源组名称**： **awrgstudxx**，其中 **xx** 是你的姓名缩写。

    - **资源组位置**： 最靠近实验室位置的 Azure 区域的名称，在其中你能预配 Azure VM 的位置。

      > **备注**： 要识别你的订阅中可用的 Azure 区域，请参阅 [**https://azure.microsoft.com/zh-cn/regions/offers/**](https://azure.microsoft.com/en-us/regions/offers/)

        ![在 Azure 门户中创建资源组](Linked_Image_Files/M02-E02-T01-img01.png)

4. 在“创建资源组”屏幕中，单击 **“查看 + 创建”**。

5. 在“创建资源组”屏幕中，单击 **“创建”**。

> **备注**： 创建资源组大约需要 30 秒。你可以检查通知区域以检查创建完成的时间。

### 任务 2：创建和配置存储帐户。

1. 在 Azure 门户中，单击屏幕左上方的 **“主页”** 超链接

2. 在 Azure 门户中，单击 **“+ 创建资源”** 图标。

3. 在“新建”屏幕中，单击 **“搜索市场”** 文本框，然后输入 **“存储帐户”**。在显示的列表中单击 **“存储帐户”**。

4. 在 **“存储帐户”** 屏幕中，单击 **“创建”**。

5. 从 **“创建存储帐户”** 屏幕，使用以下设置创建第一个存储帐户：

    - 在项目详细信息下，指定以下设置：

        - **订阅**： 你用于本实验室的订阅名称
    
        - **资源组**： **awrgstudxx**，其中 **xx** 是你的姓名缩写。

    - 在实例详细信息下，指定以下设置：
    
        - **存储帐户名称**： **awsastudxx**，其中 **xx** 是你的姓名缩写。

        - **位置**： 最靠近实验室位置的 Azure 区域的名称，在其中你能预配 Azure VM 的位置。

        - **性能**： **标准**。

        - **帐户类型**： **StorageV2（常规用途 v2）**。

        - **复制**： **读取访问异地冗余存储 (RA_GRS)**

            ![Azure 门户中的创建存储帐户设置](Linked_Image_Files/M02-E02-T02-img01.png)

6. 在 **“创建存储帐户”** 屏幕中，单击 **“查看 + 创建”**。

7. 确认 **“创建存储帐户”** 屏幕后，单击 **“创建”**。

   > **备注**： 创建存储帐户大约需要 90 秒，同时根据你定义的设置预配磁盘和磁盘配置。

### 任务 3：在存储帐户中创建和配置容器。

1. 在 Azure 门户中，消息说明 _“你的部署已完成”_，单击按钮 **“转到资源”**。

2. 在 **awsastudxx** 屏幕中，其中 **xx** 是你的姓名缩写，在 **“Blob 服务”** 下单击 **“容器”**。

3. 在 **“awsastudxx - 容器”** 屏幕中，在左上角单击 **“+ 容器”** 按钮。

4. 在 **“新建容器”** 屏幕中，使用以下设置创建容器：

    - 名称： **图像**。

    - 公共访问级别： **专用（禁止匿名访问）**

        ![在 Azure 门户中创建容器](Linked_Image_Files/M02-E02-T03-img01.png)

5. 在 **“新建容器”** 屏幕中，单击 **“创建”**。

   > **备注**： 容器即时创建，并将出现在 **“awrgstudxx - 容器”** 屏幕的列表中。

6. 重复步骤 4-5 以创建名为 **phonecalls** 的容器，公共访问级别为 **“专用（禁止匿名访问）”**

7. 重复步骤 4-5 以创建名为 **tweets** 的容器，公共访问级别为 **“专用（禁止匿名访问）”** 你的屏幕应如下图所示：

    ![Azure 门户中的容器列表](Linked_Image_Files/M02-E02-T03-img02.png)

### 任务 4：将一些图形上传到存储帐户的图像容器中。

1. 在 Azure 门户中的 **“awsastudxx - 容器”** 屏幕中，单击列表中的 **“图像”** 项目。

2. 在 **“图像”** 屏幕中，单击 **“上传”** 按钮。

3. 在 **“上传 blob”** 屏幕中，在文件文本框中，单击文本框右侧的 **“文件夹”** 图标。

4. 在 **“打开”** 对话框中，浏览 **Labfiles\Starter\DP-200.2\website graphics** 文件夹。突出显示以下文件：

    - one.png

    - two.png

    - three.png

    - No.png

5. 在 **“打开”** 对话框中，单击 **“打开”**。 

6. 在 **“上传 blob”** 屏幕中，单击 **“上传”** 按钮。

7. 关闭 **“上传 blob”** 屏幕，并关闭 **“图像”** 屏幕。

8. 关闭 **“awsastudxx - 容器”** 屏幕，在 Azure 门户中，导航到 **“主页”** 屏幕。 

   > **备注**：  文件上传将需要大约 5 秒钟。完成后，它们将出现在“上传 blob”屏幕的列表中。

> **结果**：  完成本练习后，你已创建一个名为 awsastudxx 的存储帐户，该帐户具有一个名为“图像”的容器，其中包含四个可以在 AdventureWorks 网站上使用的图形文件。

## 练习 3：解释 Azure Data Lake Storage
  
预计用时：15 分钟

个人练习
  
本次练习的主要任务如下：

1. 在资源组 awrgstudxx 中，在距离实验室位置最近的区域创建并配置名为 **awdlsstudxx** 的存储帐户，作为 Data Lake Store Gen2 存储类型，其中 **xx** 是你的姓名缩写。

2. 在 awdlsstudxx 存储帐户中创建名为 **日志** 和 **数据** 的容器。


### 任务 1：创建存储帐户并将其配置为 Data Lake Store Gen II 存储。

1. 在 Azure 门户中，单击 **“+ 创建资源”** 图标。

2. 在“新建”屏幕中，单击 **“搜索市场”** 文本框，然后输入 **“存储”**。在显示的列表中单击 **“存储帐户”**。

3. 在 **“存储帐户”** 边栏选项卡上，单击 **“创建”**。

4. 从 **“创建存储帐户”** 边栏选项卡，使用以下设置创建一个存储帐户：

    - 在项目详细信息下，指定以下设置：

        - **订阅**： 你用于本实验室的订阅名称
    
        - **资源组名称**： **awrgstudxx**，其中 **xx** 是你的姓名缩写。

    - 在实例详细信息下，指定以下设置：

        - **存储帐户名称**： **awdlsstudxx**，其中 **xx** 是你的姓名缩写。

        - **位置**： 最靠近实验室位置的 Azure 区域的名称，在其中你能预配 Azure VM。

        - **性能**： **标准**。

        - **帐户类型**： **StorageV2（常规用途 v2）**。

        - **复制**： **读取访问异地冗余存储 (RA_GRS)**

5. 单击 **“高级”** 选项卡。

6. 在“Data Lake Storage Gen2”下，单击 **“分层命名空间”** 下的 **“已启用”**。

    ![Azure 门户中“创建存储帐户”屏幕中的定义“分层命名空间”设置](Linked_Image_Files/M02-E03-T01-img01.png)

7. 在 **“创建存储帐户”** 边栏选项卡中，单击 **“查看 + 创建”**。

8. 验证 **“创建存储帐户”** 边栏选项卡后，单击 **“创建”**。

   > **备注**： 创建存储帐户大约需要 90 秒，同时根据你定义的设置预配磁盘和磁盘配置。

### 任务 2：在存储帐户中创建和配置容器。

1. 在 Azure 门户中，消息说明_“你的部署已完成”_，单击按钮 **“转到资源”**。

2. 在 **awdlsstudxx** 屏幕，其中 **xx** 是你的姓名缩写，单击 **“容器”**。

3. 在 **“awrgstudxx - 容器”** 屏幕中，在左上角单击 **“+ 容器”** 按钮。

4. 在 **“新建”** 屏幕中，使用以下名称创建两个容器：

    - 名称： **数据**，公共访问级别为 **“专用（禁止匿名访问）”**。

    - 名称： **日志**，公共访问级别为 **“专用（禁止匿名访问）”**。

5. 在 **“新建容器”** 屏幕，单击 **“创建”**。

   > **备注**： 文件系统即时创建，并将出现在 **“awdlsstudxx - 容器”** 屏幕的列表中，如下所示。

    ![Azure 门户中列出的文件系统](Linked_Image_Files/M02-E03-T02-img01.png)

> **结果**： 完成本练习后，你已创建名为 awdlsstudxx 的 Data Lake Gen2 的存储帐户，该帐户具有名为“数据”和“日志”的文件系统。

## 练习 4：将数据上传到 Azure Data Lake。
  
预计用时：10 分钟

个人练习
  
本次练习的主要任务如下：

1. 安装并启动 Microsoft Azure 存储资源管理器

2. 将一些数据文件上传到 Data Lake Gen II 存储帐户的容器。

### 任务 1：安装存储资源管理器。

3. 在 Azure 门户中的 **awdlsstudxx** 概述页面，导航到 **“在资源管理器中打开”**，然后单击 **“下载 Azure 存储资源管理器”** 超链接。

4. 你将进入以下 [Azure 存储资源管理器](https://azure.microsoft.com/zh-cn/features/storage-explorer/)网页，其中有一个 **“立即下载”** 按钮。单击该按钮。

5. 在 Microsoft Edge 对话框中单击 **“保存”**，下载完成后，单击 **“查看下载”**，在 Microsoft Edge 的下载屏幕中，单击 **“打开文件夹”**。这将打开“下载”文件夹。

6. 双击文件 **StorageExplorer.exe**，在“用户帐户控制”对话框中单击 **“是”**。

7. 在“许可协议”屏幕中，选择 **“我同意协议”** 旁边的单选按钮，然后单击 **“安装”**。

   > **备注**： 存储资源管理器的安装大约需要 4 分钟。Azure 存储资源管理器允许你使用它来轻松管理存储帐户的内容。上传、下载和管理 blob、文件、队列、表和 Cosmos DB 实体。它还使你可以轻松访问，以管理虚拟机磁盘。

8. 完成安装后，确保选择了 **“启动 Microsoft Azure 存储资源管理器”** 旁边的复选框，然后单击 **“完成”**。Microsoft Azure 存储资源管理器打开并列出你的订阅。

9. 在存储资源管理器中，选择 **“管理帐户”**，然后转至 **“帐户管理面板”**。

10. 此时，左窗格会显示已登录的所有 Azure 帐户。要连接到其他帐户，请选择 **“添加帐户”**。

11. 如果你想登录到国家云或 Azure Stack，请单击 Azure 环境下拉列表，然后选择要使用的 Azure 云。选择环境后，单击 **“登录…”** 按钮。

12. 成功登录 Azure 帐户后，会将该帐户及与其相关的 Azure 订阅添加到左窗格中。选择要使用的 Azure 订阅，然后选择 **“应用”**。左窗格显示与选定 Azure 订阅相关的存储帐户。

    ![Azure 存储资源管理器](Linked_Image_Files/M02-E04-T01-img01.png)

### 任务 2：将数据文件上传到 Data Lake Gen II 存储帐户的数据和日志容器。

1. 在 Azure 存储资源管理器中，单击箭头以展开你的订阅。

2. 在 **“存储帐户”** 下，搜索存储帐户 **awdlsstudxx (ADLS Gen2)**，然后单击箭头将其展开。

3. 在 **“Blob 容器”** 下，单击箭头将其展开并显示 **“日志”** 文件系统。单击 **“日志”** 文件系统。

4. 在 Azure 存储资源管理器中，单击 **“上传”** 图标旁边的箭头，然后单击 **“上传文件..”**。

5. 在“上传文件”对话框中，单击 **“选定的文件”** 文本框旁边的省略号。

6. 在 **“选择待上传的文件”** 对话框中，浏览 **Labfiles\Starter\DP-200.2\logs** 文件夹。突出显示以下文件：

    - weblogsQ1.log

    - weblogsQ2.log

    - preferences.json

7. 在 **“选择待上传的文件”** 对话框中，单击 **“打开”**。

8. 在 **“上传文件”** 屏幕中，单击 **“上传”** 按钮。

   ![在 Azure 存储资源管理器中上传文件](Linked_Image_Files/M02-E04-T02-img01.png)

9. 在 **“Blob 容器”** 下，单击箭头将其展开并显示 **“数据”** 文件系统。单击 **“数据”** 文件系统。

10. 在 Azure 存储资源管理器中，单击 **“上传”** 图标旁边的箭头，然后单击 **“上传文件..”**。

11. 在“上传文件”对话框中，单击 **“选定的文件”** 文本框旁边的省略号。

12. 在 **“选择待上传的文件”** 对话框中，浏览到 **Labfiles\Starter\DP-200.2\Static Files** 文件夹。突出显示以下文件：

    - DimDate2.txt

13. 在 **“选择待上传的文件”** 对话框中，单击 **“打开”**。

14. 在 **“上传文件”** 屏幕中，单击 **“上传”** 按钮。

15. 重复上述步骤以将 preferences.JSON 文件从 **Labfiles\Starter\DP-200.2\logs** 文件夹上传到 Data Lake Store gen2 中的 **“数据”** 文件系统

   > **备注**： 文件上传将需要大约 5 秒钟。你将在 Azure 存储资源管理器中看到消息，其内容如下： **你的视图可能缺少数据。是否要刷新？单击“是”**。完成后，所有两个文件将显示在上传 blob 屏幕的列表中。

    ![在 Azure 存储资源管理器中上传到容器的文件](Linked_Image_Files/M02-E04-T02-img02.png)

16. 在 Azure 存储资源管理器的数据文件系统中，单击 **“+ 新建文件夹”** 按钮。

17. 在“新建文件夹”屏幕的“新建文件夹”名称文本框中，键入 **“输出”**。

18. 关闭 Azure 存储资源管理器。

19. 返回 Azure 门户，然后导航到 **“主页”** 边栏选项卡。

> **结果**： 完成本练习后，你已创建名为 awdlsstudxx 的 Data Lake Gen II 的存储帐户，该帐户具有名为“数据”的文件系统，其中包含两个可供 AdventureWorks 数据科学家使用的网络日志文件。
